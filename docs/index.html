<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="description" content="App">
    <meta name='viewport' content='width=device-width, height=device-height, initial-scale=1.0'>
    <title>App</title>
</head>
<body>

    <script>
        async function calc() {
            var postfix = document.getElementById('location').value;
            var useElevationParam = "&ue=off"; 
            if (postfix.indexOf(",ue") >= 1 ) {
                useElevationParam = "&ue=on";
                postfix = postfix.replace(",ue", "");
            }
            if (postfix.indexOf(',') > 0) {
                postfix = "latitude=" + postfix.split(',')[0].trim() + "&longitude=" + postfix.split(',')[1].trim();
            } else if (postfix.charAt(0) >= '0' && postfix.charAt(0) <= '9') {
                postfix = "geonameid=" + postfix;
            } else {
                postfix = "city=" + postfix;
            }
            const url = `https://www.hebcal.com/zmanim?cfg=json&` + postfix + useElevationParam; 
            try {
                const response = await fetch(url, { headers: { 'Accept': 'application/json' } });
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();
                document.getElementById('sunrise') .innerHTML = data.times.sunrise;
                document.getElementById('sunset')  .innerHTML = data.times.sunset;
                document.getElementById('foundLoc').innerHTML = data.location.title;
            } catch (error) {
                alert("Error fetching zmanim data " + error);
            }

            //
            const url2 = `https://www.hebcal.com/shabbat?cfg=json&` + postfix + useElevationParam;
            try {
                const response = await fetch(url2, { headers: { 'Accept': 'application/json' } });
                if (! response.ok) throw new Error('Network response was not ok');
                const data = await response.json();
                document.getElementById('parasha') .innerHTML = data.items[1].hebrew;
                document.getElementById('lighting').innerHTML = data.items[0].title;
                for (let i = 2; i < data.items.length; i++) {
                    if (data.items[i].category === 'havdalah') {
                        document.getElementById('havdala').innerHTML = data.items[i].title;
                        break;
                    }
                }
            } catch (error) {
                alert("Error fetching Shabbat data " + error);
            }

            const date = new Date();
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0'); // Month is 0-indexed
            const day = date.getDate().toString().padStart(2, '0');
            const formattedDate = `${year}-${month}-${day}`;
            const url3 = `https://www.hebcal.com/hebcal?v=1&cfg=json&F=on&start=` + formattedDate + `&end=` + formattedDate;
            try {
                const response = await fetch(url3, { headers: { 'Accept': 'application/json' } });
                if (! response.ok) throw new Error('Network response was not ok');
                const data = await response.json();
                document.getElementById('dafYomi').innerHTML = data.items[0].hebrew;
            } catch (error) {
                alert("Error fetching DafYomi data " + error);
            }
            
        }

    </script>

<h2>App</h2>
<hr>
Links: <a href="links-shabbat.html">links.html</a><br>
<br/>
iPhone Shortcut: <a href="https://www.icloud.com/shortcuts/0b04a8e93d9a47e2977a04c9048a93b5">https://www.icloud.com/shortcuts/0b04a8e93d9a47e2977a04c9048a93b5</a><br>
<br><img src="iphone-shortcut.jpeg" width="80p"><br>
<br>
Android App: <a href="https://play.google.com/store/apps/details?id=com.shahartal.myquietchannel">https://play.google.com/store/apps/details?id=com.shahartal.myquietchannel</a><br>
<br><img src="Google_Play_Store_badge_EN.svg" width="150p">

<br>
<br>
<hr>
<br>
<label id="clock"></label><br><br>
ğŸ•¯ğŸ•¯ ×©×‘×ª <label id="parasha"></label><br><br>
<label id="lighting"></label><br>
ğŸŒ <label id="havdala"></label><br><br>
ğŸ”† ×–×¨×™×—×” ×”×™×•×<br><label id="sunrise"></label><br>
ğŸŒ… ×©×§×™×¢×”<br><label id="sunset"></label><br><br>
×”×“×£ ×”×™×•××™<br><label id="dafYomi"></label><br><br>
ğŸ“ ××™×§×•×<br>
<input type="text" id="location" value="IL-Jerusalem">
<button onClick="calc()">Refresh</button><br>
<label id="foundLoc">IL-Jerusalem</label>
<script>
    calc();
        
    function updateClock() {
        const now = new Date();
        const hours = now.getHours();
        const minutes = now.getMinutes();
        const seconds = now.getSeconds();
        const formattedTime = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        document.getElementById('clock').innerHTML = formattedTime;
    }

    updateClock();

    setInterval(updateClock, 1000);

</script>
</body>
</html>